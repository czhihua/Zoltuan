"use strict";$(function(){var a;function l(n){var a=JSON.parse(n);if(a.total){var e=a.data,t=e.map(function(n){return" <li data-id='"+n.id+'\'>\n                            <a href="javascript:;">\n                                \x3c!-- 商品图片 --\x3e\n                                <div class="gn-pic">\n                                    <img src="../img/'+n.pic+'" alt="">\n                                </div>\n                                \x3c!-- 商品概要 --\x3e\n                                <div class="gn-brief">\n                                    \x3c!-- 名字 --\x3e\n                                    <p class="gn-name">'+n.goodsName+'</p>\n                                    <p class="gn-intro">'+n.intro+'</p>\n                                    \x3c!-- 价格购买 --\x3e\n                                    <div class="gn-detail">\n                                        <div class="detail-left">\n                                            <span class="gn-current">￥'+n.current+'</span>\n                                            <span class="gn-original">￥'+n.original+'</span>\n                                            <span class="gn-save">立省'+1*(n.original-n.current)+'</span>\n                                        </div>\n                                        <span class="gn-btn">\n                                            马上抢\n                                        </span>\n                                    </div>\n                                </div>\n                                \x3c!-- 倒计时时间 --\x3e\n                                <div class="gn-time">\n                                    <span>剩余：\n                                        <em>00</em>天\n                                        <em>00</em>时\n                                        <em>00</em>分\n                                        <em>00</em>秒</span>\n                                </div>\n                            </a>\n                        </li>'}).join("");if($("#goods-nav").html(t),setInterval(function(){for(var n=(new Date).getTime(),a=0;a<e.length;a++){var t=1*e[a].time-n,s=getDuration(t);$("#goods-nav li").eq(a).find(".gn-time").html("\n                                        <span>剩余：\n                                        <em>"+toDB(s[0])+"</em>天\n                                        <em>"+toDB(s[1])+"</em>时\n                                        <em>"+toDB(s[2])+"</em>分\n                                        <em>"+toDB(s[3])+"</em>秒\n                                        </span>\n                                    ")}},1e3),a.total>a.num){var s="";if(1<Math.ceil(a.total/a.num)){for(var i=1;i<=2;i++)s+="<span>"+i+"</span>";$("#gn-paging").html(s),$("#gn-paging span").eq(a.page-1).attr("class","active"),$("#gn-paging").append("<span>下一页</span>")}}else $("#gn-paging").html("")}else{t='<div style="height:600px; font-size:30px;">没有相关商品</div>';$("#goods-nav").html(t)}}function t(){var n=$(".tt-type a").eq(0).attr("class");"active"==n?($(".tt-default").on("click",function(){$.ajax({type:"post",url:"../api/goodlist.php",data:{dbsql:"rush",page:"1",num:"24"},success:function(n){l(n)}})}),$(".tt-newest").on("click",function(){$.ajax({type:"post",url:"../api/goodlist.php",data:{dbsql:"rush",page:"1",num:"24"},success:function(n){l(n)}})}),$(".tt-sales").on("click",function(){$.ajax({type:"post",url:"../api/sort.php",data:{dbsql:"rush",page:"1",num:"24",sort:"descend",demand:"sales"},success:function(n){l(n);JSON.parse(n)}})}),$(".tt-price").on("click",function(){$.ajax({type:"post",url:"../api/sort.php",data:{dbsql:"rush",page:"1",num:"24",sort:"ascend",demand:"current"},success:function(n){l(n)}})}),$("#gn-paging").on("click","span",function(){var n=$(".tt-nav .tt-default a").attr("class"),a=$(".tt-nav .tt-newest").find("a").attr("class"),t=$(".tt-nav .tt-sales a").attr("class"),s=$(".tt-nav .tt-price").find("a").attr("class");if($("body,html").stop().animate({scrollTop:"0px"},0),$(".lanjiaz").css("display","block"),$("#goods-nav").css("display","none"),setTimeout(function(){$(".lanjiaz").css("display","none"),$("#goods-nav").css("display","block")},1e3),n||a){if($(this).index()!=$("#gn-paging span").length-1)$.ajax({type:"post",url:"../api/goodlist.php",data:{dbsql:"rush",page:$(this).index()+1,num:"24"},success:function(n){l(n)}});else if($(this).index()==$("#gn-paging span").length-1){var e=$("#gn-paging").find(".active").text(),i=++e>$("#gn-paging span").length-1?e-1:e;$.ajax({type:"post",url:"../api/goodlist.php",data:{dbsql:"rush",page:i,num:"24"},success:function(n){l(n)}})}}else if(t||s){var o=$(".tt-nav li .active").find("span").text(),p="销售"==o?"sales":"current",c="销售"==o?"descend":"ascend";if(console.log(o,c),$(this).index()!=$("#gn-paging span").length-1)console.log($(this).index()+1),$.ajax({type:"post",url:"../api/sort.php",data:{dbsql:"rush",page:$(this).index()+1,num:"24",sort:c,demand:p},success:function(n){l(n)}});else if($(this).index()==$("#gn-paging span").length-1){e=$("#gn-paging").find(".active").text(),i=++e>$("#gn-paging span").length-1?e-1:e;$.ajax({type:"post",url:"../api/sort.php",data:{dbsql:"rush",page:i,num:"24",sort:c,demand:p},success:function(n){l(n)}})}}})):n||($(".tt-default").off("click"),$(".tt-newest").off("click"),$(".tt-sales").off("click"),$(".tt-price").off("click"),$("#gn-paging").off("click"))}tiaozhuang(),pullDown("hnav-menu","sub-Menus","onmouseover"),a=$("#today-title").offset().top,$(window).scroll(function(){var n=$(document).scrollTop();a<=n?($("#today-title").attr("class","today-ceiling"),$(".tt-tab").css("margin","0")):n<a&&($("#today-title").attr("class",""),$(".tt-tab").css("margin-bottom","10px"))}),onoption(),function(){var n=window.location.search;if(n){var a=n.substring(1).split("=");"type"==a[0]&&$.ajax({type:"post",url:"../api/query.php",data:{dbsql:"rush",name:"type",query:["手机","电脑","DIY","数码","外设","智能","其他"][a[1]-1],page:1,num:24,now:a[1]},success:function(n){l(n),$(".tt-type").find("a").attr("class",""),$(".tt-type").find("a").eq(a[1]).attr("class","active"),t(),e(n)}})}else $.ajax({type:"post",url:"../api/goodlist.php",data:{dbsql:"rush",page:"1",num:"24"},success:function(n){l(n)}});t()}(),t(),$("#gn-paging").on("click","span",function(){$("#gn-paging").find("span").attr("class",""),$(this).attr("class","active"),$("#gn-paging").find("span:last-child").attr("class",""),$("body,html").stop().animate({scrollTop:"0px"},0),$(".lanjiaz").css("display","block"),$("#goods-nav").css("display","none"),setTimeout(function(){$(".lanjiaz").css("display","none"),$("#goods-nav").css("display","block")},1e3),t()}),$("#gn-paging").on("click","span:last-child",function(){$("body,html").stop().animate({scrollTop:"0px"},0);var n=$("#gn-paging").find(".active").text();$("#gn-paging").find("span").attr("class",""),n=++n>$("#gn-paging span").length-1?$("#gn-paging span").length-1:n,$("#gn-paging").find("span").eq(n).attr("class","active"),$(".lanjiaz").css("display","block"),$("#goods-nav").css("display","none"),setTimeout(function(){$(".lanjiaz").css("display","none"),$("#goods-nav").css("display","block")},1e3),t()}),setTimeout(function(){$(".lanjiaz").css("display","none"),$("#goods-nav").css("display","block")},1e3),function(){for(var n=1;n<$(".tt-type a").length;n++){var a=$(".tt-type a").eq(n).find("span").text();$.ajax({type:"post",url:"../api/query.php",data:{query:a,dbsql:"rush",name:"type",now:n},success:function(n){var a,t=JSON.parse(n);a=t,$(".tt-type a").eq(a.now).append($("<i>("+a.total+")</i>"))}})}}(),function(){for(var n=1;n<$(".tt-deputy:eq(0) a").length;n++){var a=$(".tt-deputy:eq(0) a").eq(n).find("span").text();$.ajax({type:"post",url:"../api/query.php",data:{query:a,dbsql:"rush",name:"viceType",now:n},success:function(n){var a,t=JSON.parse(n);a=t,$(".tt-deputy:eq(0) a").eq(a.now).append($("<i>("+a.total+")</i>"))}})}}(),function(){for(var n=1;n<$(".tt-deputy:eq(1) a").length;n++){var a=$(".tt-deputy:eq(1) a").eq(n).find("span").text();$.ajax({type:"post",url:"../api/query.php",data:{query:a,dbsql:"rush",name:"viceType",now:n},success:function(n){var a,t=JSON.parse(n);a=t,$(".tt-deputy:eq(1) a").eq(a.now).append($("<i>("+a.total+")</i>"))}})}}();var s=!0;function e(n){var t=JSON.parse(n),a=t.now;a&&($(".tt-default").on("click",function(){$.ajax({type:"post",url:"../api/query.php",data:{dbsql:"rush",page:"1",num:"24",query:t.name,now:a,name:"type"},success:function(n){l(n)}})}),$(".tt-newest").on("click",function(){$.ajax({type:"post",url:"../api/query.php",data:{dbsql:"rush",page:"1",num:"24",query:t.name,now:a,name:"type"},success:function(n){l(n)}})}),$(".tt-sales").on("click",function(){$.ajax({type:"post",url:"../api/sort.php",data:{dbsql:"rush",page:"1",num:"24",sort:"descend",demand:"sales",query:t.name,name:"type"},success:function(n){l(n)}})}),$(".tt-price").on("click",function(){$.ajax({type:"post",url:"../api/sort.php",data:{dbsql:"rush",page:"1",num:"24",sort:"ascend",demand:"current",query:t.name,name:"type"},success:function(n){l(n)}})}),$("#gn-paging").on("click","span",function(){if($(this).index()!=$("#gn-paging span").length-1)$.ajax({type:"post",url:"../api/query.php",data:{dbsql:"rush",page:$(this).index()+1,num:"24",query:t.name,now:n,name:"type"},success:function(n){l(n)}});else if($(this).index()==$("#gn-paging span").length-1){var n=$("#gn-paging").find(".active").text(),a=++n>$("#gn-paging span").length-1?n-1:n;$.ajax({type:"post",url:"../api/query.php",data:{dbsql:"rush",page:a,num:"24",query:t.name,now:n,name:"type"},success:function(n){l(n)}})}}))}$(".tt-type").on("click","a",function(){if(s&&0!=$(this).index()){var n=$(this).find("span").text();$(".tt-type").find("a").attr("class",""),$(this).attr("class","active"),$(".tt-nav li").find("a").attr("class",""),$(".tt-nav li").eq(0).find("a").attr("class","active"),$(".lanjiaz").css("display","block"),$("#goods-nav").css("display","none"),$("body,html").stop().animate({scrollTop:"0px"},0),s=!1,$.ajax({type:"post",url:"../api/query.php",data:{dbsql:"rush",name:"type",now:$(this).index(),query:n,page:1,num:24},success:function(n){l(n),e(n)}}),setTimeout(function(){$(".lanjiaz").css("display","none"),$("#goods-nav").css("display","block"),s=!0},1e3)}t()}),$(".tt-type").on("click","a:eq(0)",function(){i&&(i=!1,$(".tt-nav li").find("a").attr("class",""),$(".tt-nav li").eq(0).find("a").attr("class","active"),$(".tt-type a").attr("class",""),$(this).attr("class","active"),$("body,html").stop().animate({scrollTop:"0px"},0),$.ajax({type:"post",url:"../api/goodlist.php",data:{dbsql:"rush",page:"1",num:"24"},success:function(n){l(n)}}),$(".lanjiaz").css("display","block"),$("#goods-nav").css("display","none"),setTimeout(function(){$(".lanjiaz").css("display","none"),$("#goods-nav").css("display","block"),i=!0},1e3)),t()});var n,i=!0;BacktoTop(),(n=window.localStorage.getItem("username"))?($(".ht-login").find("i").text("您好，"+n),$(".ht-login").find("a").css("display","none"),$(".ht-res").css("display","none"),$(".ht-quit").css("display","inline"),$.ajax({type:"post",url:"../api/goodlist.php",data:{dbsql:"cart",user:n},success:function(n){var a=JSON.parse(n);$(".ht-nav li:eq(2)").find("a").html("购物车"+a.total1+"件"),$(".qe-cart").find("em").html(a.total1),$(".ht-nav li:eq(2)").on("click",function(){location.href="cart.html"}),$(".qe-cart").on("click",function(){location.href="cart.html"})}})):($(".ht-login").find("i").text("Hi~欢迎来到Z商城，请"),$(".ht-login").find("a").css("display","inline"),$(".ht-res").css("display","inline"),$(".ht-quit").css("display","none"),$(".qe-cart").on("click",function(){var n=window.location.pathname;location.href="login.html?"+n}),$(".ht-nav li:eq(2)").on("click",function(){var n=window.location.pathname;location.href="login.html?"+n})),logout(),$(".ht-login a").on("click",function(){var n=window.location.pathname;location.href="login.html?"+n}),$("#goods-nav").on("click","li",function(){var n=$(this).attr("data-id");location.href="../html/detail.html?id="+n}),$("#search-text").focus(function(){$(this).val(""),$(this).attr("placeholder","找找你想要的商品")})});