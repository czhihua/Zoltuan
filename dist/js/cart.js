"use strict";$(function(){var n;tiaozhuang(),function(){var n=window.localStorage.getItem("username");if(n)$(".ht-login").find("i").text("您好，"+n),$(".ht-login").find("a").css("display","none"),$(".ht-res").css("display","none"),$(".ht-quit").css("display","inline"),$.ajax({type:"post",url:"../api/goodlist.php",data:{dbsql:"cart",user:n},success:function(n){var t=JSON.parse(n);$(".ht-nav li:eq(2)").find("a").html("购物车"+t.total1+"件"),$(".ht-nav li:eq(2)").on("click",function(){location.href="cart.html"})}});else{$(".ht-login").find("i").text("Hi~欢迎来到Z商城，请"),$(".ht-login").find("a").css("display","inline"),$(".ht-res").css("display","inline"),$(".ht-quit").css("display","none");var t=window.location.pathname;location.href="login.html?"+t}}(),logout(),n=window.localStorage.getItem("username"),$.ajax({type:"post",url:"../api/goodlist.php",data:{dbsql:"cart",user:n},success:function(n){!function(n){for(var t=JSON.parse(n),a=t.total1,e=0,i=[],s=0;s<t.data.length;s++)e+=1*t.data[s].current,i.push(t.data[s].shop);$(".shopping_be").prepend('\n            <div class="cart_title">\n                        <p>购物车状态\n                            <span>('+a+'/30)</span>\n                        </p>\n                        <div class="cart-total">\n                            <span>总计(不含运费)\n                                <em>￥'+e+'</em>\n                            </span>\n                            <a href="javascript:;">去结算</a>\n                        </div>\n                    </div>\n        ');var p=uniq(i);$(".shopping_be").append('\n            <div class="cart_list">\n                <div class="cl-title">\n                        <span class="Goods">所有商品</span>\n                        <span class="price">单价（元）</span>\n                        <span class="number">数量</span>\n                        <span class="time">优惠</span>\n                        <span class="subtotal">小计（元）</span>\n                        <span class="operation">操作</span>\n                 </div>\n            </div>\n        ');var c=p.map(function(n){return'<div class="clt-inner">\n                        <div class="clt-shop">\n                            <p>\n                                <input class="check_all" type="checkbox">\n                                <span>店铺：</span>\n                                <a href=" javascript:; ">\n                                    '+n+"\n                                </a>\n                            </p>\n                        </div> \n                    </div>"});$(".shopping_be .cart_list").append(c);for(var l=[],r=0;r<p.length;r++)$.ajax({type:"post",url:"../api/query.php",async:!1,data:{dbsql:"cart",query:p[r],name:"shop",now:r},success:function(n){var t=JSON.parse(n),a=t.data,e=t.now,i=a.map(function(n){return l.push(n.time),'<div class="ctl_list" data-id="'+n.productid+'">\n                                    <div class="ctl-details">\n\n                                        <input class="choice" type="checkbox">\n\n                                        <div class="ct-pic ">\n                                            <img src="../img/'+n.pic+' " alt=" ">\n                                        </div>\n                                        <div class="ct-intro ">\n                                        <a href="javascript:; " class="goodsName ">'+n.goodsName+'</a>\n                                        <p class="support ">\n                                            <i></i>\n                                        </p>\n                                        <p class="color ">\n                                            颜色：'+n.color+'\n                                        </p>\n                                        <p class="color ">\n                                            套装：官方标配\n                                        </p>\n                                        </div>\n\n                                    </div>\n\n                                    <div class="unit_price ">\n                                        <p class="original ">'+(1*n.original).toFixed(2)+'</p>\n                                        <p class="current ">'+(1*n.current).toFixed(2)+'</p>\n                                    </div>\n\n                                    <div class="input_num ">\n\n                                        <a href="javascript:; " class="minus ">-</a>\n                                        <input type="number" value="'+n.num+'" data-xg="'+n.quota+'">\n                                        <a href="javascript:; " class="add ">+</a>\n\n                                    </div>\n\n                                    <div class="group-time ">\n                                        <span>团购</span>\n                                        <p>\n                                            <em>00</em>小时\n                                            <em>00</em>分\n                                            <em>00</em>秒\n                                        </p>\n                                    </div>\n\n                                    <div class="goods_subtotal ">\n                                        '+n.current*n.num+'\n                                    </div>\n\n                                    <div class="list_operation">\n                                        <a href="javascript:; ">移入收藏夹</a>\n                                        <a class="onDel" href="javascript:; ">删除</a>\n                                    </div>\n\n                                </div>'});$(".shopping_be .clt-inner").eq(e).append(i)}});function o(){for(var n=$(".shopping_be .clt-inner").length,t=0;t<n;t++){var a=$(".shopping_be .clt-inner").eq(t).find(".ctl_list").length;0==a&&$(".shopping_be .clt-inner").eq(t).remove()}}function d(){var n=$(".shopping_be").find(".clt-inner").length;0==n&&($(".shopping_be").css("display","none"),$(".empty").css("display","block"))}function h(){for(var n=$(".shopping_be").find(".ctl_list").length,t=0,a=0;a<n;a++){var e=$(".shopping_be").find(".ctl_list").eq(a).find(".ctl-details input").prop("checked");e&&(t+=1*$(".shopping_be").find(".ctl_list").eq(a).find(".current").html())}$(".clt-total").find("em").html("￥"+t)}setInterval(function(){for(var n=0;n<l.length;n++){var t=(new Date).getTime(),a=1*l[n]-t,e=xiaoshi(a);$(".cart_list").eq(n).find(".group-time").html("\n                             <span>团购</span>\n                                <p>\n                                    <em>"+toDB(e[0])+"</em>小时\n                                    <em>"+toDB(e[1])+"</em>分\n                                    <em>"+toDB(e[2])+"</em>秒\n                                </p>\n                ")}},1e3),$(".cart_list").append('\n            <div class="clt-bottom">\n\n                        <div class="clt-top">\n                            <p class="clt-total">\n                                商品总价\n                                <i>（不含运费）：</i>\n                                <em>￥0</em>\n                            </p>\n                        </div>\n\n                        <div class="clt-accounts">\n                            <p class="ca-left">\n                                <a class="colse-btn" href="javascript:;">批量删除</a>\n                            </p>\n                            <p class="ca-right">\n                                <a class="continue" href="javascript:;">\n                                    <<继续购物 </a>\n                                        <span class="accounts-btn">去结算</span>\n                            </p>\n                        </div>\n                    </div>\n        '),$(".check_all").on("click",function(){$(this).prop("checked")?$(this).parent().parent().siblings(".ctl_list").find(".choice").prop("checked","checked"):$(this).parent().parent().siblings(".ctl_list").find(".choice").prop("checked",""),h()}),$(".shopping_be").on("click",".choice",function(){for(var n,t,a=$(this).parent().parent().parent().find(".choice").length,e=!0,i=0;i<a;i++)(n=$(this).parent().parent().parent().find(".choice").eq(i).prop("checked"))||(e=!1);for(var s=a-1;0<=s;s--)t=$(this).parent().parent().parent().find(".choice").eq(s).prop("checked"),n||(e=!1);n&&t&&e?$(this).parent().parent().parent().find(".check_all").prop("checked","checked"):$(this).parent().parent().parent().find(".check_all").prop("checked",""),h()}),$(".shopping_be").on("click",".add",function(){var n=$(this).prev().val(),t=$(this).prev().attr("data-xg");n=++n>=1*t?1*t:n;var a=$(this).parent().parent().attr("data-id");$(this).prev().val(n);var e=$(this).parent().prev().find(".current").html(),i=e*n;$(this).parent().next().next().html(i),$.ajax({type:"post",url:"../api/alterCart.php",data:{Id:a,num:n,dbsql:"cart"},success:function(n){}}),h()}),$(".shopping_be").on("click",".minus",function(){var n=$(this).next().val();n=--n<=0?1:n;var t=$(this).parent().parent().attr("data-id");$(this).next().val(n);var a=$(this).parent().prev().find(".current").html(),e=a*n;$(this).parent().next().next().html(e),h(),$.ajax({type:"post",url:"../api/alterCart.php",data:{Id:t,num:n,dbsql:"cart"},success:function(n){}})}),$(".shopping_be").on("blur",".input_num input",function(){var n=$(this).val(),t=$(this).attr("data-xg"),a=$(this).parent().parent().attr("data-id");console.log(1*t),1*t<=n?$(this).val(t):n<=0&&$(this).val(1);var e=$(this).parent().prev().find(".current").html(),i=e*n;$(this).parent().next().next().html(i),$.ajax({type:"post",url:"../api/alterCart.php",data:{Id:a,num:n,dbsql:"cart"},success:function(n){}})}),$(".shopping_be").on("click",".onDel",function(){var n=confirm("你确定要删除选中商品吗？");if(n){var t=$(this).parent().parent().attr("data-id");$(this).parent().parent().remove(),o(),d(),h(),$.ajax({type:"post",url:"../api/delete.php",data:{delete:"cart",Id:t},success:function(n){}})}}),$(".colse-btn").on("click",function(){for(var n=[],t=$(".shopping_be").find(".ctl_list .ctl-details input").length,a=t;0<=a;a--){var e=$(".shopping_be").find(".ctl_list .ctl-details input").eq(a).prop("checked");e&&n.push(a)}if(0<n.length){var i=confirm("你确定要删除选中的商品吗？");if(i){for(var s=0;s<n.length;s++){var p=$(".shopping_be").find(".ctl_list").eq(n[s]).attr("data-id"),e=$(".shopping_be").find(".ctl_list").eq(n[s]).remove();$.ajax({type:"post",url:"../api/delete.php",data:{delete:"cart",Id:p},success:function(n){}})}o(),d(),h()}}else n.length<=0&&alert("请勾选商品")}),$(".accounts-btn").on("click",function(){for(var n=[],t=$(".shopping_be").find(".ctl_list .ctl-details input").length,a=t;0<=a;a--){var e=$(".shopping_be").find(".ctl_list .ctl-details input").eq(a).prop("checked");e&&n.push(a)}if(0<n.length){var i=confirm("你确定要结算选中的商品吗？");if(i){for(var s=0;s<n.length;s++){var p=$(".shopping_be").find(".ctl_list").eq(n[s]).attr("data-id"),e=$(".shopping_be").find(".ctl_list").eq(n[s]).remove();$.ajax({type:"post",url:"../api/delete.php",data:{delete:"cart",Id:p},success:function(n){alert("已购买成功")}})}o(),d(),h()}o(),d(),h()}else n.length<=0&&alert("请勾选商品")}),o(),d()}(n)}}),$(".ht-quit").on("click",function(){window.localStorage.clear();var n=window.location.pathname;location.href="login.html?"+n})});